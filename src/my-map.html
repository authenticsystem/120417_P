<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map-poly.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="my-icons.html">

<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="my-lot-details.html">

<dom-module id="my-map">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      @media (max-width: 767px) {
        iron-image.logo {
          width: 64px;
          height: 64px;
        }

        /* div.legendHeader {
          display: none;
        }

        div.myLegend {
          position: absolute;
          margin: 11px;
          bottom: 70px;
          background: white;
          height: 580px;
          width: 52px;
          opacity: .75;
          padding: 10px;
          font-size: 10px;
        }

        div.displayBig {
          display: none;
        } */
        div.myLegend {
          position: absolute;
          margin: 11px;
          bottom: 70px;
          background: white;
          height: 430px;
          width: 210px;
          opacity: 1;
          padding: 10px;
          font-size: 11px;
          border-radius: 2px;
          z-index: 10;
          /* box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2); */
        }

      }

      @media (min-width: 767px) {
        iron-image.logo {
          width: 128px;
          height: 128px;
        }

        div.myLegend {
          position: absolute;
          margin: 11px;
          bottom: 70px;
          background: white;
          height: 430px;
          width: 210px;
          opacity: 1;
          padding: 10px;
          font-size: 12px;
          border-radius: 2px;
          z-index: 10;
          /* box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2); */
        }

        /* div.legendHeaderSmall {
          display: none;
        }

        div.myLegend {
          position: absolute;
          margin: 11px;
          bottom: 70px;
          background: white;
          height: 430px;
          width: 210px;
          opacity: 1;
          padding: 10px;
          font-size: 12px;
        }

        div.displaySmall {
          display: none;
        } */
      }



      div.myLegendLess {
        display: none;
        position: absolute;
        margin: 10px;
        bottom: 70px;
        background: white;
        height: 24px;
        width: 86px;
        opacity: 1;
        padding-top: 8px;
        padding-left: 8px;
        font-size: 12px;
        z-index: 0;
      }


      div.logo {
        padding: 16px;
        position: absolute;
        float: left;
      }

      .myToolbar {
        margin: 16px;
        margin-right: 32px;
        position: absolute;
        float: right;
        right: 0px;
      }

      .myToolbarSignIn {
        /* margin: 16px;
        margin-right: 32px;
        position: absolute;
        float: right;
        right: 0px; */
        background: white;
        height: 32px;
        font-size: 12px;
        font-weight: 400;
        background: green;
        color: white;
        width: 80px;
      }

      .myToolbar_refresh {
        margin-top: 12px;
        margin-right: 32px;
        position: absolute;
        float: right;
        right: 100px;
        color: green;
      }

      .myViewMap {
        width: 250px;
        height: 64px;
        background-color: red;
        color: white;

        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        margin: auto;

        max-width: 100%;
        max-height: 100%;
        overflow: auto;
      }

      paper-dialog.colored {
        background-color: #EEEEEE;
      }
    </style>

    <app-header-layout fullbleed has-scrolling-region>

      <template is="dom-if" if="{{_viewMap('false',viewMap)}}">
        <iron-image class="logo" placeholder="images/manifest/map-ph.png" data-src="images/manifest/map-ph.png" sizing="cover" preload
          fade style="width:100%; height:100%;"></iron-image>
      </template>

      <template is="dom-if" if="{{_viewMap('true',viewMap)}}">
        <paper-toast id="toast" text="Loading Map." duration=0 opened style="margin-left: calc(50vw - 150px);"></paper-toast>

        <firebase-document path="/statuscolor" data="{{statuscolor}}">
        </firebase-document>

        <firebase-query id="query" path="/blocks" data="{{blocks}}">
        </firebase-query>

        <google-map latitude="10.3015672115449" longitude="123.998173749625" zoom="18" api-key="AIzaSyCT4PT1u_Yia3SLTiCj6XMoq0xZFGMfVWY"
          no-auto-tilt="true" fit-to-markers disable-street-view-control="true" additional-map-options='{"mapTypeControlOptions": {"position": 6},"fullscreenControl": false}'>

          <template is="dom-repeat" items="{{blocks}}" as='block'>
            <!-- #cbe6a3 -->
            <google-map-poly closed stroke-color="{{block.maprenderdetails.stroke_color}}" stroke-weight="1" stroke-opacity="1" fill-color="{{block.maprenderdetails.bg_color}}"
              fill-opacity="1" clickable="true" click-events="true" on-google-map-poly-click="polyBlocksClicked"
              mouse-events="true" on-google-map-poly-mouseover="polyMouseOver" on-google-map-poly-mouseout="polyMouseOut" id="{{block.$key}}">
              <template is="dom-repeat" items="{{block.map_points}}" as='point'>
                <google-map-point longitude="{{point.longitude}}" latitude="{{point.latitude}}"></google-map-point>
              </template>
            </google-map-poly>

          </template>


          <firebase-query id="query" path="/lots" data="{{lots}}" order-by-child="part" equal-to="{{selectedPart}}">
          </firebase-query>

          <template is="dom-repeat" items="{{lots}}" as='lot'>

            <google-map-poly closed stroke-color="{{lot.maprenderdetails.stroke_color}}" stroke-position="inside" stroke-opacity="1"
              stroke-weight="1" fill-color="{{lot.maprenderdetails.bg_color}}" fill-opacity="1" clickable="true" click-events="true"
              on-google-map-poly-click="polyClicked" mouse-events="true" on-google-map-poly-mouseover="polyMouseOver" on-google-map-poly-mouseout="polyMouseOut"
              id="{{lot.$key}}">

              <template is="dom-repeat" items="{{lot.map_points}}" as='point'>
                <google-map-point longitude="{{point.longitude}}" latitude="{{point.latitude}}"></google-map-point>
              </template>

            </google-map-poly>
          </template>


        </google-map>

        <div class="myLegendLess" id="myLegendLess">
          <span>Legend:</span>
          <paper-icon-button style="float: right;  top: -12px; right: 0px;" icon="my-icons:expand-less" on-tap="showLegend"></paper-icon-button>
        </div>

        <div class="myLegend" id="myLegend">
          <div class="legendHeader">
            <span>Legend:</span>
            <paper-icon-button style="float: right;  top: -8px; right: 0px;" icon="my-icons:expand-more" on-tap="hideLegend"></paper-icon-button>
            </br>
            <span>--------------------------------------------------</span>
          </div>

          <!-- <div class="legendHeaderSmall">
            <span>LEGEND:</span>
            </br>
            <span>---</span>
          </div> -->

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="lawnlots" id="legendLawnLots"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Lawn Lots</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="wallniche" id="legendWallNiche"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Wall Niche</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="cinerarium" id="legendCinerarium"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Cinerarium</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="bonechamber" id="legendBoneChamber"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Bone Chamber</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="gardenlots1" id="legendGardenLots1"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Garden Lots 1 (Area=12.52m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="gardenlots2" id="legendGardenLots2"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Garden Lots 1 (Area=12.43m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="gardenlots3" id="legendGardenLots3"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Garden Lots 1 (Irregular Lots)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="gardenlots4" id="legendGardenLots4"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Garden Lots 2 (Area=20.00m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="gardenlots5" id="legendGardenLots5"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Garden Lots 2 (Irregular Lots)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="familylots1" id="legendFamilyLots1"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Family Lots 1 (Area=53.27m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="familylots2" id="legendFamilyLots2"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Family Lots 1 (Area=52.83m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="familylots3" id="legendFamilyLots3"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Family Lots 1 (Irregular Lots)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="familylots4" id="legendFamilyLots4"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Family Lots 2 (Area=37.45m²)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="familylots5" id="legendFamilyLots5"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Family Lots 2 (Irregular Lots)</span>
            </div>
          </div>

          <div class="legendHeader">
            <span>--------------------------------------------------</span>
          </div>
          <!-- <div class="legendHeaderSmall">
            <span>---</span>
          </div> -->

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="available" id="legendAvailable"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Available</span>
            </div>

            <div style="display:flex; left: 124px; position: absolute;">
              <div style="display: inline-block; height: 16px; width: 16px;" data-args="regular" id="legendRegular"></div>
              <div class="displayBig" style="margin-left: 8px;">
                <span>Regular</span>
              </div>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="sold" id="legendSold"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Sold</span>
            </div>

            <div style="display:flex;left: 124px; position: absolute;">
              <div style="display: inline-block; height: 16px; width: 16px;" data-args="special" id="legendSpecial"></div>
              <div class="displayBig" style="margin-left: 8px;">
                <span>Special</span>
              </div>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="soldlacking" id="legendSoldLacking"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Sold/Lacking</span>
            </div>

            <div style="display:flex;left: 124px; position: absolute;">
              <div style="display: inline-block; height: 16px; width: 16px;" data-args="premium" id="legendPremium"></div>
              <div class="displayBig" style="margin-left: 8px;">
                <span>Premium</span>
              </div>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="reserved" id="legendReserved"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Reserved</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="hold" id="legendHold"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>On-Hold</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;">
            <div style="display: inline-block; height: 16px; width: 16px;" data-args="notyetavailable" id="legendNotyetavailable"></div>
            <div class="displayBig" style="margin-left: 8px;">
              <span>Not yet available</span>
            </div>
          </div>

        </div>

      </template>

      <template is="dom-if" if="{{_needToSignIn(user,statusKnown)}}">
        <div class="logo">
          <a href="/">
            <iron-image class="logo" placeholder="images/manifest/icon-48x48.png" data-src="images/manifest/icon-48x48.png" sizing="contain"
              preload fade></iron-image>
          </a>
        </div>

        <paper-icon-button class="myToolbar_refresh" icon="my-icons:refresh" on-tap="_refreshMap"></paper-icon-button>

        <div class="myToolbar">
          <a href="/signin" style="text-decoration: none;">
            <paper-button raised noink class="myToolbarSignIn">Sign In</paper-button>
          </a>
        </div>
      </template>

      <template is="dom-if" if="{{_alreadySignedIn(user,statusKnown)}}">
        <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer" style="position: absolute; left: 16px; top: 16px; color: green;"></paper-icon-button>
        <div style="position: absolute; float: right; right: 16px; padding: 16px;">
          <a href="/">
            <iron-image class="logo" placeholder="images/manifest/icon-48x48.png" data-src="images/manifest/icon-48x48.png" sizing="contain"
              preload fade></iron-image>
          </a>
        </div>

        <paper-icon-button style="position: absolute; float: left; left: 52px; color: green; top:16px;" icon="my-icons:refresh" on-tap="_refreshMap"></paper-icon-button>
      </template>


      <paper-button class="myViewMap" id="myViewMap" raised on-click="_showMap">
        <iron-icon icon="my-icons:map" style="padding-right: 8px;"></iron-icon>
        <span>VIEW MAP</span>
      </paper-button>

      <my-lot-details id="lotDetailsPane" selected-lot="{{selectedLot}}" style="display: none;"></my-lot-details>
    </app-header-layout>



  </template>

  <script>
    Polymer({
      is: 'my-map',

      properties: {
        blocks: {
          type: Object,
          observer: '_blocksLoaded'
        },
        lots: {
          type: Object,
          observer: '_lotsLoaded'
        },
        viewMap: {
          type: Boolean,
          value: false
        },
        statuscolor: {
          type: Object,
          observer: '_statusColorChanged'
        },
        selectedPart: {
          type: Array,
          value: ''
        },
        previousPartSelected: Object,
        selectedLot: String,
        narrow: {
          type: Boolean,
          notify: true
        },
        user: {
          type: Object,
          value: null,
          notify: true
        },
        statusKnown: {
          type: Boolean,
          value: true,
          notify: true,
        }

      },

      hideLegend() {
        var legend = Polymer.dom(this.root).querySelector("#myLegend");
        legend.style.display = "none";

        var legendless = Polymer.dom(this.root).querySelector("#myLegendLess");
        legendless.style.display = "block";

      },

      showLegend() {
        var legend = Polymer.dom(this.root).querySelector("#myLegend");
        legend.style.display = "block";

        var legendless = Polymer.dom(this.root).querySelector("#myLegendLess");
        legendless.style.display = "none";

      },

      _needToSignIn(e, f) {
        if (f === true) {
          return e === null;
        }
        else {
          return false;
        }
      },

      _alreadySignedIn(e, f) {
        if (f === true) {
          return e !== null;
        }
        else {
          return false;
        }
      },

      _statusColorChanged() {
        if (this.statuscolor) {
          var argsLawnLots = Polymer.dom(this.root).querySelector("#legendLawnLots")
          if (argsLawnLots) {
            argsLawnLots.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsLawnLots.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsLawnLots.getAttribute("data-args")) + ";");
          }

          var argsWallNiche = Polymer.dom(this.root).querySelector("#legendWallNiche")
          if (argsWallNiche) {
            argsWallNiche.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsWallNiche.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsWallNiche.getAttribute("data-args")) + ";");
          }

          var argsCinerarium = Polymer.dom(this.root).querySelector("#legendCinerarium")
          if (argsCinerarium) {
            argsCinerarium.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsCinerarium.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsCinerarium.getAttribute("data-args")) + ";");
          }

          var argsBoneChamber = Polymer.dom(this.root).querySelector("#legendBoneChamber")
          if (argsBoneChamber) {
            argsBoneChamber.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsBoneChamber.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsBoneChamber.getAttribute("data-args")) + ";");
          }

          var argsGardenLots1 = Polymer.dom(this.root).querySelector("#legendGardenLots1")
          if (argsGardenLots1) {
            argsGardenLots1.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsGardenLots1.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsGardenLots1.getAttribute("data-args")) + ";");
          }

          var argsGardenLots2 = Polymer.dom(this.root).querySelector("#legendGardenLots2")
          if (argsGardenLots2) {
            argsGardenLots2.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsGardenLots2.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsGardenLots2.getAttribute("data-args")) + ";");
          }

          var argsGardenLots3 = Polymer.dom(this.root).querySelector("#legendGardenLots3")
          if (argsGardenLots3) {
            argsGardenLots3.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsGardenLots3.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsGardenLots3.getAttribute("data-args")) + ";");
          }

          var argsGardenLots4 = Polymer.dom(this.root).querySelector("#legendGardenLots4")
          if (argsGardenLots4) {
            argsGardenLots4.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsGardenLots4.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsGardenLots4.getAttribute("data-args")) + ";");
          }

          var argsGardenLots5 = Polymer.dom(this.root).querySelector("#legendGardenLots5")
          if (argsGardenLots5) {
            argsGardenLots5.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsGardenLots5.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsGardenLots5.getAttribute("data-args")) + ";");
          }

          var argsFamilyLots1 = Polymer.dom(this.root).querySelector("#legendFamilyLots1")
          if (argsFamilyLots1) {
            argsFamilyLots1.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsFamilyLots1.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsFamilyLots1.getAttribute("data-args")) + ";");
          }

          var argsFamilyLots2 = Polymer.dom(this.root).querySelector("#legendFamilyLots2")
          if (argsFamilyLots2) {
            argsFamilyLots2.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsFamilyLots2.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsFamilyLots2.getAttribute("data-args")) + ";");
          }

          var argsFamilyLots3 = Polymer.dom(this.root).querySelector("#legendFamilyLots3")
          if (argsFamilyLots3) {
            argsFamilyLots3.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsFamilyLots3.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsFamilyLots3.getAttribute("data-args")) + ";");
          }

          var argsFamilyLots4 = Polymer.dom(this.root).querySelector("#legendFamilyLots4")
          if (argsFamilyLots4) {
            argsFamilyLots4.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsFamilyLots4.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsFamilyLots4.getAttribute("data-args")) + ";");
          }

          var argsFamilyLots5 = Polymer.dom(this.root).querySelector("#legendFamilyLots5")
          if (argsFamilyLots5) {
            argsFamilyLots5.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsFamilyLots5.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsFamilyLots5.getAttribute("data-args")) + ";");
          }

          var argsAvailable = Polymer.dom(this.root).querySelector("#legendAvailable")
          if (argsAvailable) {
            argsAvailable.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsAvailable.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsAvailable.getAttribute("data-args")) + ";");
          }

          var argsSold = Polymer.dom(this.root).querySelector("#legendSold")
          if (argsSold) {
            argsSold.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsSold.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsSold.getAttribute("data-args")) + ";");
          }

          var argsSoldLacking = Polymer.dom(this.root).querySelector("#legendSoldLacking")
          if (argsSoldLacking) {
            argsSoldLacking.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsSoldLacking.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsSoldLacking.getAttribute("data-args")) + ";");
          }

          var argsReserved = Polymer.dom(this.root).querySelector("#legendReserved")
          if (argsReserved) {
            argsReserved.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsReserved.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px; border-color:" + this._getStatusStrokeColor(argsReserved.getAttribute("data-args")) + ";");
          }

          var argsHold = Polymer.dom(this.root).querySelector("#legendHold")
          if (argsHold) {
            argsHold.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsHold.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsHold.getAttribute("data-args")) + ";");
          }

          var argsNotyetavailable = Polymer.dom(this.root).querySelector("#legendNotyetavailable")
          if (argsNotyetavailable) {
            argsNotyetavailable.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsNotyetavailable.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 1px;  border-color:" + this._getStatusStrokeColor(argsNotyetavailable.getAttribute("data-args")) + ";");
          }

          var argsRegular = Polymer.dom(this.root).querySelector("#legendRegular")
          if (argsRegular) {
            argsRegular.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background:  " + this._getStatusColor(argsRegular.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 2px;  border-color:" + this._getStatusStrokeColor(argsRegular.getAttribute("data-args")) + ";");
          }

          var argsSpecial = Polymer.dom(this.root).querySelector("#legendSpecial")
          if (argsSpecial) {
            argsSpecial.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsSpecial.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 2px;  border-color:" + this._getStatusStrokeColor(argsSpecial.getAttribute("data-args")) + ";");
          }

          var argsPremium = Polymer.dom(this.root).querySelector("#legendPremium")
          if (argsPremium) {
            argsPremium.setAttribute("style", "display: inline-block; height: 16px; width: 16px; background: " + this._getStatusColor(argsPremium.getAttribute("data-args")) + "; opacity: 1; border-style: solid; border-width: 2px;  border-color:" + this._getStatusStrokeColor(argsPremium.getAttribute("data-args")) + ";");
          }

        }

      },

      _getStatusColor(e) {
        if (e) {
          if (e) {
            if (this.statuscolor) {
              if (this.statuscolor[e]) {
                return (this.statuscolor[e]).bg_color;
              }
              else {
                return "gray";
              }
            }
            else {
              return "gray";
            }
          }
          else {
            return "gray";
          }
        }
        else {
          return "gray";
        }

      },

      _getStatusStrokeColor(e) {
        if (e) {
          if (e) {
            if (this.statuscolor) {
              if (this.statuscolor[e]) {
                if ((this.statuscolor[e]).stroke_color) {
                  return (this.statuscolor[e]).stroke_color;
                }
                else {
                  return "white";
                }
              }
              else {
                return "white";
              }
            }
            else {
              return "white";
            }
          }
          else {
            return "white";
          }
        }
        else {
          return "white";
        }

      },

      polyClicked(e) {

        var data_args = Polymer.dom(e).rootTarget.getAttribute("id");

        if (this.selectedLot) {
          if (this.selectedLot != data_args) {
            var prevSelectedLot = Polymer.dom(this.root).querySelector("#" + this.selectedLot);
            prevSelectedLot.fillOpacity = 1;
          }
        }

        this.selectedLot = data_args;

        var args = Polymer.dom(this.root).querySelector("#lotDetailsPane")
        args.setAttribute("style", "display: block;");

      },

      polyBlocksClicked(e) {
        var toast = Polymer.dom(this.root).querySelector("#toast");
        toast.duration = 0;

        var data_args = Polymer.dom(e).rootTarget.getAttribute("id");

        if (data_args !== this.previousPartSelected) {
          this.selectedPart = data_args;

          toast.show({ text: 'Loading Lots for ' + this.selectedPart + '...' });
          Polymer.dom(e).rootTarget.poly.setVisible(false);

          if (this.previousPartSelected) {
            var args = Polymer.dom(this.root).querySelector("#" + this.previousPartSelected);
            args.poly.setVisible(true);
          }

          this.previousPartSelected = data_args;

          this.selectedLot = null;

          var args = Polymer.dom(this.root).querySelector("#lotDetailsPane")
          args.setAttribute("style", "display: none;");
        }

      },

      polyMouseOver(e) {
        // Polymer.dom(e).rootTarget.setAttribute("stroke-color", "black");
        Polymer.dom(e).rootTarget.setAttribute("fill-opacity", ".5");
      },

      polyMouseOut(e) {
        // Polymer.dom(e).rootTarget.setAttribute("stroke-color", "white");
        // if(this.selectedLot!=)

        var data_args = Polymer.dom(e).rootTarget.getAttribute("id");
        if (data_args != this.selectedLot) {
          Polymer.dom(e).rootTarget.setAttribute("fill-opacity", "1");
        }

      },

      _viewMap(e, f) {
        if (e === 'true') {
          return f === true;
        }
        else {
          return f === false;
        }
      },

      _showMap() {
        this.viewMap = true;

        if (this.viewMap) {
          var args = Polymer.dom(this.root).querySelector("#myViewMap");
          args.setAttribute("style", "display: none;");
        }
        else {
          var args = Polymer.dom(this.root).querySelector("#myViewMap");
          args.setAttribute("style", "display: block;");
        }
      },

      _refreshMap() {
        window.location.reload()
      },

      _lotsLoaded() {
        var toast = Polymer.dom(this.root).querySelector("#toast");

        if (this.lots.length > 0) {
          toast.close();
        }
        else {
          if (toast) {
            if (toast.text != 'Loading Map.') {
              toast.duration = 1000;
              toast.cancel(this);
            }
          }

        }


      },

      _blocksLoaded() {
        var toast = Polymer.dom(this.root).querySelector("#toast")

        if (this.blocks.length > 0) {
          toast.close();
        }
        else {
          if (toast) {

            if (toast.text != 'Loading Map.') {
              toast.duration = 1000;
              toast.cancel(this);
            }
          }
        }

      },
      toggleDrawer() {
        this.dispatchEvent(new CustomEvent('toggleDrawer', {
          bubbles: true, composed: true, detail: {
            narrow: this.$.narrow
          }
        }));
        this.$.narrow = !this.$.narrow;
      }



    })

  </script>
</dom-module>