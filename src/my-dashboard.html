<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-buttons-group/paper-buttons-group.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-behavior.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/polymerfire/firebase-messaging.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="chartjs.html">

<dom-module id="my-dashboard">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            @media (min-width: 768px) {
                app-toolbar {
                    margin-bottom: 50px;
                }

                app-header {
                    height: 250px;
                }

                .responsiveFlex {
                    @apply --layout-horizontal;
                }
            }

            @media (max-width: 768px) {
                app-toolbar {
                    margin-bottom: 10px;
                }

                app-header {
                    height: 175px;
                }

                .responsiveFlex {
                    @apply --layout-vertical;
                }
            }

            .my-container {
                padding: 16px;
            }

            paper-card {
                margin-bottom: 16px;
                width: 100%
            }

            app-header {
                /* color: rgb(255, 255, 255); */
                /* background-color: #388E3C; */
                background: #00b09b;
                /* fallback for old browsers */
                background: -webkit-linear-gradient(to right, #96c93d, #00b09b);
                /* Chrome 10-25, Safari 5.1-6 */
                background: linear-gradient(to right, #96c93d, #00b09b);
                /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
            }

            paper-button {
                height: 32px;
                font-size: 12px;
                font-weight: 400;
            }

            .horizontal {
                @apply --layout-horizontal;
            }

            .flex {
                @apply --layout-flex;
            }

            .totalSHR {
                text-align: center;
                padding: 4px;
            }

            table {
                border-collapse: collapse;
                border-spacing: 0;
                width: 100%;
                border: 1px solid #ddd;
            }

            th,
            td {
                text-align: left;
                padding: 8px;
                font-size: 12px;
            }

            tr:nth-child(even) {
                background-color: #f2f2f2
            }

            #customGroup {
                --paper-buttons-group-selected: {
                    background-color: green !important;
                    color: white;
                }

                paper-button {
                    width: 80px;
                }
            }

            paper-tab {
                --paper-tab: {
                    color: #388E3C;
                }

                --paper-tab-content-unselected: {
                    color: black;
                }
            }

            paper-tabs {
                --paper-tabs-selection-bar-color: #388E3C;
            }

            paper-item {
                font-size: 12px;
            }

            .chart-container {
                height: 500px !important;
            }
        </style>

        <firebase-messaging id="messaging" token="{{token}}" on-message="handleMessage"></firebase-messaging>
        <firebase-document path="/users/[[myaccountKey]]/token" data="[[token]]"></firebase-document>

        <app-header-layout fullbleed has-scrolling-region>
            <app-header fixed slot="header">
                <app-toolbar primary>
                    <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button>
                    <div main-title hidden$="{{!access}}">Dashboard</div>
                    <div main-title hidden$="{{access}}">Opps!</div>
                </app-toolbar>

                <div class="my-container">
                    <neon-animated-pages selected="{{selectedPage}}" entry-animation="{{entryanimation}}"
                        exit-animation="{{exitanimation}}">
                        <neon-animatable>
                            <paper-card class="header-card" heading="Today Sales Report" hidden$="{{!salesStaff}}">
                                <div class="card-content">
                                    <!-- <div>
                                <paper-input type="date" value="{{todayDate}}"></paper-input>
                            </div> -->
                                    <div class="horizontal">
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FF6E40;">Sold</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FF9E80;">{{totalSold}}</div>
                                        </div>
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FFAB40;">Hold</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FFD180;">{{totalHold}}</div>
                                        </div>
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FFD600;">Reserved</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FFFF8D;">{{totalReserved}}</div>
                                        </div>
                                    </div>

                                    <div style="overflow-x:auto; padding: 4px; margin-top: 16px;" id="staffTable">
                                        <table>
                                            <tr>
                                                <th colspan="6">{{todayDate}}</th>
                                            </tr>
                                            <tr>
                                                <th>Lot types</th>
                                                <th>Lot</th>
                                                <th>Status</th>
                                                <th>Agent</th>
                                                <th>Buyer</th>
                                                <th>Date</th>
                                            </tr>
                                            <template is="dom-repeat" items="[[todayLotDetails]]">
                                                <tr>
                                                    <td>{{_formatLotTypes(item.type)}}</td>
                                                    <td>{{_formatLots(item.block, item.lot, item.level)}}</td>
                                                    <td style="text-align: left;">{{item.status}}</td>
                                                    <td style="text-align: left;">{{item.reservationdetails.agentdetails.firstname}}
                                                        {{item.reservationdetails.agentdetails.middlename}}
                                                        {{item.reservationdetails.agentdetails.lastname}}
                                                    </td>
                                                    <td style="text-align: left;">{{item.reservationdetails.buyerdetails.firstname}}
                                                        {{item.reservationdetails.buyerdetails.middlename}}
                                                        {{item.reservationdetails.buyerdetails.lastname}}
                                                    </td>
                                                    <td style="text-align: left;">{{_getLocalDatetimeFormat(item.reservationdetails.start)}}</td>
                                                </tr>
                                            </template>
                                            <tr>
                                                <td colspan="6" style="text-align: center">---End---</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-actions" hidden$="{{!sales}}">
                                    <span style="float: right; margin-bottom: 8px;">
                                        <paper-button on-tap="_next">
                                            View More <iron-icon icon="my-icons:arrow-forward"></iron-icon>
                                        </paper-button>
                                    </span>
                                </div>
                            </paper-card>

                            <paper-card class="header-card" hidden$="{{!agent}}" heading="My Today's Report">
                                <div class="card-content">
                                    <!-- <div>
                                        <paper-input type="date" value="{{todayDate}}"></paper-input>
                                    </div> -->
                                    <div class="horizontal">
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FF6E40;">Sold</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FF9E80;">{{agentTotalSold}}</div>
                                        </div>
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FFAB40;">Hold</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FFD180;">{{agentTotalHold}}</div>
                                        </div>
                                        <div class="flex totalSHR">
                                            <div style="padding: 4px; background-color: #FFD600;">Reserved</div>
                                            <div style="font-size: 64px; padding: 4px; background-color: #FFFF8D;">{{agentTotalReserved}}</div>
                                        </div>
                                    </div>

                                    <div style="overflow-x:auto; padding: 4px; margin-top: 16px;" id="agentTable">
                                        <table>
                                            <tr>
                                                <th colspan="6">{{todayDate}}</th>
                                            </tr>
                                            <tr>
                                                <th>Lot types</th>
                                                <th>Lot</th>
                                                <th>Status</th>
                                                <th>Agent</th>
                                                <th>Buyer</th>
                                                <th>Date</th>
                                            </tr>
                                            <template is="dom-repeat" items="[[agentTodayLotDetails]]">
                                                <tr>
                                                    <td>{{_formatLotTypes(item.lotdetails.type)}}</td>
                                                    <td>{{_formatLots(item.lotdetails.block, item.lotdetails.lot,
                                                        item.lotdetails.level)}}</td>
                                                    <td style="text-align: left;">{{item.type}}</td>
                                                    <td style="text-align: left;">{{item.agentdetails.firstname}}
                                                        {{item.agentdetails.middlename}}
                                                        {{item.agentdetails.lastname}}
                                                    </td>
                                                    <td style="text-align: left;">{{item.buyerdetails.firstname}}
                                                        {{item.buyerdetails.middlename}}
                                                        {{item.buyerdetails.lastname}}
                                                    </td>
                                                    <td style="text-align: left;">{{_getLocalDatetimeFormat(item.start)}}</td>
                                                </tr>
                                            </template>
                                            <tr>
                                                <td colspan="6" style="text-align: center">---End---</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-actions" hidden$="{{!allAgentsReports}}">
                                    <span style="float: right; margin-bottom: 8px;">
                                        <paper-button on-tap="_next">
                                            View More <iron-icon icon="my-icons:arrow-forward"></iron-icon>
                                        </paper-button>
                                    </span>
                                </div>
                            </paper-card>
                        </neon-animatable>
                        <neon-animatable>
                            <paper-card hidden$="{{!sales}}">
                                <div>
                                    <paper-tabs id="tabReports" attr-for-selected="name" selected="{{selectedReport}}">
                                        <paper-tab name="activity">Activity</paper-tab>
                                        <paper-tab name="comparative">Comparative</paper-tab>
                                        <paper-tab name="overall">Over All</paper-tab>
                                    </paper-tabs>
                                </div>
                                <div class="card-content">
                                    <iron-pages attr-for-selected="name" selected="{{selectedReport}}">
                                        <div name="activity">
                                            <div>
                                                <center>
                                                    <paper-buttons-group attr-for-selected="name" selected="{{selectedDWMY}}"
                                                        id="customGroup">
                                                        <paper-button name="daily" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px;  border-top-left-radius: 5px 5px; border-bottom-left-radius: 5px 5px;">Daily</paper-button>
                                                        <paper-button name="weekly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px">Weekly</paper-button>
                                                        <paper-button name="monthly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px">Monthly</paper-button>
                                                        <paper-button name="yearly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; border-right: 1px solid green; height:33px; border-top-right-radius: 5px 5px; border-bottom-right-radius: 5px 5px;">Yearly</paper-button>
                                                    </paper-buttons-group>
                                                </center>
                                            </div>

                                            <iron-pages attr-for-selected="name" selected="{{selectedDWMY}}">
                                                <div name="daily">
                                                    <paper-input style="width: 200px;" label="Date" type="date" value="{{dailyDate}}">
                                                        <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                    </paper-input>
                                                </div>
                                                <div name="weekly">
                                                    <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                    <paper-input value={{weeklyYear}} style="width:60px;display:inline-block"
                                                        type="number" label="Year"></paper-input>
                                                    <paper-input value={{weeklyNum}} style="width:60px;display:inline-block"
                                                        type="number" label="Week"></paper-input>
                                                    <span style="font-size:12px">{{weeklyDateRange}}</span>
                                                </div>
                                                <div name="monthly">
                                                    <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                    <paper-dropdown-menu label="Month" style="width:100px; display:inline-block">
                                                        <paper-listbox slot="dropdown-content" attr-for-selected="value"
                                                            selected="{{monthlyMonth}}">
                                                            <paper-item value="01">January</paper-item>
                                                            <paper-item value="02">February</paper-item>
                                                            <paper-item value="03">March</paper-item>
                                                            <paper-item value="04">April</paper-item>
                                                            <paper-item value="05">May</paper-item>
                                                            <paper-item value="06">June</paper-item>
                                                            <paper-item value="07">July</paper-item>
                                                            <paper-item value="08">August</paper-item>
                                                            <paper-item value="09">September</paper-item>
                                                            <paper-item value="10">October</paper-item>
                                                            <paper-item value="11">November</paper-item>
                                                            <paper-item value="12">December</paper-item>
                                                        </paper-listbox>
                                                    </paper-dropdown-menu>
                                                    <paper-input value={{monthyYear}} style="width:70px;display:inline-block"
                                                        type="number" label="Year"></paper-input>
                                                </div>
                                                <div name="yearly">
                                                    <paper-input value={{yearlyYear}} type="number" style="width:100px; display:inline-block"
                                                        label="Year">
                                                        <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                    </paper-input>
                                                </div>
                                            </iron-pages>

                                            <div style="font-size: 12px">
                                                <paper-toggle-button checked={{showActivityTable}}>Show Table</paper-toggle-button>
                                            </div><br>

                                            <template is="dom-if" if="{{!showActivityTable}}">
                                                <div class="chart-container">
                                                    <canvas id="activityChart" width="600" height="250"></canvas>
                                                </div>
                                            </template>

                                            <template is="dom-if" if="{{showActivityTable}}">
                                                <firebase-query path="{{salesQuery}}" data="{{activityData}}"></firebase-query>
                                                <div style="overflow-x:auto;">
                                                    <table id="overAllReportTable">
                                                        <tr>
                                                            <th>Lot types</th>
                                                            <th>Sold</th>
                                                            <th>Hold</th>
                                                            <th>Reserved</th>
                                                        </tr>
                                                        <template is="dom-repeat" items="[[activityData]]">
                                                            <tr>
                                                                <td>[[_formatLotTypes(item.$key)]]</td>
                                                                <td>[[ifHasValue(item.sold)]]</td>
                                                                <td>[[ifHasValue(item.hold)]]</td>
                                                                <td>[[ifHasValue(item.reserved)]]</td>
                                                            </tr>
                                                        </template>
                                                    </table>
                                                </div>
                                            </template>
                                        </div>

                                        <div name="comparative">
                                            <div class="top">
                                                <div>
                                                    <center>
                                                        <paper-buttons-group attr-for-selected="name" selected="{{comparativeDMY}}"
                                                            id="customGroup">
                                                            <paper-button name="daily" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px;  border-top-left-radius: 5px 5px; border-bottom-left-radius: 5px 5px;">Daily</paper-button>
                                                            <paper-button name="monthly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px">Monthly</paper-button>
                                                            <paper-button name="yearly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; border-right: 1px solid green; height:33px; border-top-right-radius: 5px 5px; border-bottom-right-radius: 5px 5px;">Yearly</paper-button>
                                                        </paper-buttons-group>
                                                    </center>
                                                </div>
                                                <iron-pages attr-for-selected="name" selected="{{comparativeDMY}}">
                                                    <div name="daily" class="responsiveFlex">
                                                        <paper-input style="width: 150px; margin-right: 16px;" label="From"
                                                            type="date" value="{{dailyFrom}}">
                                                            <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                        </paper-input>
                                                        <paper-input style="width: 150px;" label="To" type="date" value="{{dailyTo}}">
                                                            <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                        </paper-input>
                                                    </div>
                                                    <div name="monthly">
                                                        <div class="responsiveFlex">
                                                            <div class="horizontal">
                                                                <paper-dropdown-menu label="Month from" style="width:100px; margin-right: 8px">
                                                                    <paper-listbox slot="dropdown-content"
                                                                        attr-for-selected="value" selected="{{monthlyMonthFrom}}">
                                                                        <paper-item value="01">January</paper-item>
                                                                        <paper-item value="02">February</paper-item>
                                                                        <paper-item value="03">March</paper-item>
                                                                        <paper-item value="04">April</paper-item>
                                                                        <paper-item value="05">May</paper-item>
                                                                        <paper-item value="06">June</paper-item>
                                                                        <paper-item value="07">July</paper-item>
                                                                        <paper-item value="08">August</paper-item>
                                                                        <paper-item value="09">September</paper-item>
                                                                        <paper-item value="10">October</paper-item>
                                                                        <paper-item value="11">November</paper-item>
                                                                        <paper-item value="12">December</paper-item>
                                                                    </paper-listbox>
                                                                </paper-dropdown-menu>
                                                                <paper-input value={{monthlyYearFrom}} style="width:70px; margin-right: 8px;"
                                                                    type="number" label="Year from"></paper-input>
                                                            </div>
                                                            <div class="horizontal">
                                                                <paper-dropdown-menu label="Month from" style="width:100px; margin-right: 8px">
                                                                    <paper-listbox slot="dropdown-content"
                                                                        attr-for-selected="value" selected="{{monthlyMonthTo}}">
                                                                        <paper-item value="01">January</paper-item>
                                                                        <paper-item value="02">February</paper-item>
                                                                        <paper-item value="03">March</paper-item>
                                                                        <paper-item value="04">April</paper-item>
                                                                        <paper-item value="05">May</paper-item>
                                                                        <paper-item value="06">June</paper-item>
                                                                        <paper-item value="07">July</paper-item>
                                                                        <paper-item value="08">August</paper-item>
                                                                        <paper-item value="09">September</paper-item>
                                                                        <paper-item value="10">October</paper-item>
                                                                        <paper-item value="11">November</paper-item>
                                                                        <paper-item value="12">December</paper-item>
                                                                    </paper-listbox>
                                                                </paper-dropdown-menu>
                                                                <paper-input value={{monthlyYearTo}} style="width:70px;"
                                                                    type="number" label="Year to"></paper-input>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div name="yearly">
                                                        <div style="display: flex">
                                                            <paper-input value={{yearlyYearFrom}} type="number" style="width:100px; margin-right: 8px;"
                                                                label="Year">
                                                                <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                            </paper-input>
                                                            <paper-input value={{yearlyYearTo}} type="number" style="width:100px;"
                                                                label="Year">
                                                                <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                            </paper-input>
                                                        </div>
                                                    </div>
                                                </iron-pages>
                                            </div>

                                            <firebase-query path="/reports/comparative" data="{{salesComparativeData}}"></firebase-query>
                                            <div>
                                                <paper-dropdown-menu style="cursor:pointer; float: right;"
                                                    vertical-align="top" horizontal-align="right">
                                                    <paper-listbox slot="dropdown-content" attr-for-selected="name"
                                                        selected="{{selectedComparativeLotTypes}}">
                                                        <paper-item id="comparativeItem" name="all">All</paper-item>
                                                        <template is="dom-repeat" items="[[salesComparativeData]]">
                                                            <paper-item id="comparativeItem" name="[[item.$key]]">[[_formatLotTypes(item.$key)]]</paper-item>
                                                        </template>
                                                    </paper-listbox>
                                                </paper-dropdown-menu>
                                            </div>

                                            <br>
                                            <div class="chart-container">
                                                <canvas id="comparativeChart" width="600" height="250"></canvas>
                                            </div>
                                            <br>
                                        </div>

                                        <div name="overall">
                                            <div>
                                                <paper-input style="width: 200px; margin-right: 16px;" label="Date"
                                                    type="date" value="{{overAllDate}}">
                                                    <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                </paper-input>
                                            </div>

                                            <div style="font-size: 12px">
                                                <paper-toggle-button checked={{showOverAllTable}}>Show Table</paper-toggle-button>
                                            </div><br>

                                            <template is="dom-if" if="{{!showOverAllTable}}">
                                                <div class="chart-container">
                                                    <canvas id="overAllChart" width="600" height="250"></canvas>
                                                </div>
                                            </template>

                                            <template is="dom-if" if="{{showOverAllTable}}">
                                                <firebase-query path="/reports/overAll/{{overAllDate}}/lotType" data="{{salesOverAllData}}"></firebase-query>
                                                <div style="overflow-x:auto;">
                                                    <table id="overAllReportTable">
                                                        <tr>
                                                            <th>Lot types</th>
                                                            <th>Sold</th>
                                                            <th>Hold</th>
                                                            <th>Reserved</th>
                                                            <th>Available</th>
                                                            <th>Not yet available</th>
                                                        </tr>
                                                        <template is="dom-repeat" items="[[salesOverAllData]]">
                                                            <tr>
                                                                <td>[[_formatLotTypes(item.$key)]]</td>
                                                                <td>[[item.sold]]</td>
                                                                <td>[[item.hold]]</td>
                                                                <td>[[item.reserved]]</td>
                                                                <td>[[item.available]]</td>
                                                                <td>[[item.notyetavailable]]</td>
                                                            </tr>
                                                        </template>
                                                    </table>
                                                </div>
                                            </template>
                                        </div>
                                    </iron-pages>
                                </div>
                                <div class="card-actions">
                                    <paper-button on-tap="_back">
                                        <iron-icon icon="my-icons:arrow-back"></iron-icon> Back
                                    </paper-button>
                                </div>
                            </paper-card>

                            <paper-card hidden$="{{!allAgentsReports}}">
                                <firebase-query path="group/{{mytype}}" data="{{groupData}}"></firebase-query>
                                <firebase-query path="agents" data="{{agentData}}"></firebase-query>

                                <div>
                                    <paper-tabs attr-for-selected="name" selected="{{selectedAgent}}" id="tabReports">
                                        <paper-tab name="myReports">My Reports</paper-tab>
                                        <template is="dom-if" if="{{agentType}}">
                                            <paper-tab name="agentType">Agent Type</paper-tab>
                                        </template>
                                        <template is="dom-if" if="{{agentGroup}}">
                                            <paper-tab name="agentGroup">Agent Group</paper-tab>
                                        </template>
                                        <template is="dom-if" if="{{agents}}">
                                            <paper-tab name="agents">Agents</paper-tab>
                                        </template>
                                    </paper-tabs>
                                </div>
                                <div class="card-content">
                                    <div class="top">
                                        <div>
                                            <center>
                                                <paper-buttons-group attr-for-selected="name" selected="{{selectedAgentDWMY}}"
                                                    id="customGroup">
                                                    <paper-button name="daily" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px;  border-top-left-radius: 5px 5px; border-bottom-left-radius: 5px 5px;">Daily</paper-button>
                                                    <paper-button name="weekly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px">Weekly</paper-button>
                                                    <paper-button name="monthly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; height:33px">Monthly</paper-button>
                                                    <paper-button name="yearly" style="font-size: 12px; border-left: 1px solid green;border-top: 1px solid green; border-bottom: 1px solid green; border-right: 1px solid green; height:33px; border-top-right-radius: 5px 5px; border-bottom-right-radius: 5px 5px;">Yearly</paper-button>
                                                </paper-buttons-group>
                                            </center>
                                        </div>
                                        <iron-pages attr-for-selected="name" selected="{{selectedAgentDWMY}}">
                                            <div name="daily">
                                                <paper-input style="width: 200px;" label="Date" type="date" value="{{agentDailyDate}}">
                                                    <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                </paper-input>
                                            </div>
                                            <div name="weekly">
                                                <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                <paper-input value={{agentWeeklyYear}} style="width:60px;display:inline-block"
                                                    type="number" label="Year"></paper-input>
                                                <paper-input value={{agentWeeklyNum}} style="width:60px;display:inline-block"
                                                    type="number" label="Week"></paper-input>
                                                <span style="font-size:12px">{{agentWeeklyDateRange}}</span>
                                            </div>
                                            <div name="monthly">
                                                <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                <paper-dropdown-menu label="Month" style="width:100px; display:inline-block">
                                                    <paper-listbox slot="dropdown-content" attr-for-selected="value"
                                                        selected="{{agentMonthlyMonth}}">
                                                        <paper-item value="01">January</paper-item>
                                                        <paper-item value="02">February</paper-item>
                                                        <paper-item value="03">March</paper-item>
                                                        <paper-item value="04">April</paper-item>
                                                        <paper-item value="05">May</paper-item>
                                                        <paper-item value="06">June</paper-item>
                                                        <paper-item value="07">July</paper-item>
                                                        <paper-item value="08">August</paper-item>
                                                        <paper-item value="09">September</paper-item>
                                                        <paper-item value="10">October</paper-item>
                                                        <paper-item value="11">November</paper-item>
                                                        <paper-item value="12">December</paper-item>
                                                    </paper-listbox>
                                                </paper-dropdown-menu>
                                                <paper-input value={{agentMonthyYear}} style="width:70px;display:inline-block"
                                                    type="number" label="Year"></paper-input>
                                            </div>
                                            <div name="yearly">
                                                <paper-input value={{agentYearlyYear}} type="number" style="width:100px; display:inline-block"
                                                    label="Year">
                                                    <iron-icon icon="my-icons:event" slot="prefix"></iron-icon>
                                                </paper-input>
                                            </div>
                                        </iron-pages>
                                    </div>

                                    <div class="chart-container">
                                        <canvas id="agentChart" width="600" height="250"></canvas>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <paper-button on-tap="_back">
                                        <iron-icon icon="my-icons:arrow-back"></iron-icon> Back
                                    </paper-button>
                                </div>
                            </paper-card>
                        </neon-animatable>
                    </neon-animated-pages>
                </div>
            </app-header>

            <firebase-query path="/reports/activity/daily" equal-to="{{todayDate}}" data="{{totalSalesData}}"></firebase-query>
            <firebase-query path="/lots" order-by-child="reservationdetails/start" start-at="{{todayDate}}T00:00" data="{{todayLotDetails}}"></firebase-query>

            <firebase-query path="/reports/sales_agents/daily/{{todayDate}}/agents/{{mytype}}/{{mygroup}}/{{myaccountKey}}"
                data="{{agentTotalSalesData}}"></firebase-query>
            <firebase-query path="/briefcase/{{myaccountKey}}" order-by-child="start" start-at="{{todayDate}}T00:00"
                end-at="{{todayDate}}T23:99" data="{{agentTodayLotDetails}}"></firebase-query>

            <div class="card" hidden$="{{access}}">
                <h3>Sorry!</h3>
                <div>You're not allowed to access this content.</div>
            </div>

        </app-header-layout>

    </template>

    <script>
        Polymer({
            is: 'my-dashboard',

            properties: {
                account: Object,
                access: Boolean,
                selectedPage: {
                    type: Number,
                    value: 0
                },
                showActivityTable: {
                    type: Boolean,
                    value: false
                },
                showOverAllTable: {
                    type: Boolean,
                    value: false
                }
            },

            observers: [
                '_tokenChanged(token)',
                '_agentTotalSalesDataChanged(agentTotalSalesData)',
                '_totalSalesDataChanged(totalSalesData)',
                '_accountChanged(account)',
                '_selectedPageChanged(selectedPage)',
                '_agentChartChanged(agentChart,selectedAgent,selectedAgentDWMY,agentDailyDate,agentWeeklyYear,agentWeeklyNum,agentMonthlyMonth,agentMonthyYear,agentYearlyYear)',
                '_selectedReportChanged(selectedReport)',
                '_activityChanged(selectedDWMY,activityChart,dailyDate,weeklyYear,weeklyNum,monthlyMonth,monthyYear,yearlyYear)',
                '_comparativeChanged(selectedComparativeLotTypes,comparativeDMY,comparativeChart,dailyFrom,dailyTo,monthlyMonthFrom,monthlyMonthTo,monthlyYearFrom,monthlyYearTo,yearlyYearFrom,yearlyYearTo)',
                '_overallChanged(overAllChart,overAllDate)'
            ],

            _tokenChanged(e) {
                if (!e) {
                    this.$.messaging.requestPermission().then(function () {
                        // permission was granted
                    }, function (err) {
                        // permission was denied
                    });
                }
            },

            ready() {
                this.todayDate = this.formatDate(new Date(), 'daily');
            },

            _agentTotalSalesDataChanged(e) {
                if (e.length > 0) {
                    if (e[0].$key === 'hold') {
                        this.agentTotalHold = e[0].$val ? e[0].$val : 0;
                    } else if (e[0].$key === 'sold') {
                        this.agentTotalSold = e[0].$val ? e[0].$val : 0;
                    } else if (e[0].$key === 'reserved') {
                        this.agentTotalReserved = e[0].$val ? e[0].$val : 0;
                    }
                } else {
                    this.agentTotalHold = 0;
                    this.agentTotalSold = 0;
                    this.agentTotalReserved = 0;
                }
            },

            _totalSalesDataChanged(e) {
                if (e.length > 0) {
                    this.totalHold = e[0].totalHold ? e[0].totalHold : 0;
                    this.totalSold = e[0].totalSold ? e[0].totalSold : 0;
                    this.totalReserved = e[0].totalReserved ? e[0].totalReserved : 0;
                } else {
                    this.totalHold = 0;
                    this.totalSold = 0;
                    this.totalReserved = 0;
                }
            },

            _accountChanged(e) {
                console.log(e);
                this.mytype = e[0].type;
                this.mygroup = e[0].group;
                this.myaccountKey = e[0].accountkey;

                this.staff = e[0].reports.staffChart;
                this.sales = e[0].reports.salesChart;
                if (this.staff === true || this.sales === true) {
                    this.salesStaff = true;
                } else {
                    this.salesStaff = false;
                }
                this.agent = e[0].reports.salesAgentChart;

                this.agentType = e[0].reports.salesAgentReport.agentstypeChart;
                this.agentGroup = e[0].reports.salesAgentReport.agentsgroupChart;
                this.agents = e[0].reports.salesAgentReport.agentsChart;

                if (this.agentType === true || this.agentGroup === true || this.agents === true) {
                    this.allAgentsReports = true;
                } else {
                    this.allAgentsReports = false;
                }
            },

            _selectedPageChanged(e) {
                if (e === 1) {
                    this.dailyDate = this.formatDate(new Date(), 'daily');
                    this.weeklyYear = this.formatDate(new Date(), 'year');
                    this.weeklyNum = this.formatDate(new Date(), 'weekNum');
                    this.weeklyDateRange = this.getDateRangeOfWeek(this.weeklyNum, this.weeklyYear);
                    this.monthlyMonth = this.formatDate(new Date(), 'month');
                    this.monthyYear = this.formatDate(new Date(), 'year');
                    this.yearlyYear = this.formatDate(new Date(), 'year');
                    this.selectedDWMY = 'daily';
                    this.selectedReport = 'activity';

                    this.selectedComparativeLotTypes = 'all';
                    this.dailyFrom = this.formatDate(new Date(), 'daily');
                    this.dailyTo = this.formatDate(new Date(), 'daily');
                    this.monthlyMonthFrom = this.formatDate(new Date(), 'month');
                    this.monthlyMonthTo = this.formatDate(new Date(), 'month');
                    this.monthlyYearFrom = this.formatDate(new Date(), 'year');
                    this.monthlyYearTo = this.formatDate(new Date(), 'year');
                    this.yearlyYearFrom = this.formatDate(new Date(), 'year');
                    this.yearlyYearTo = this.formatDate(new Date(), 'year');
                    this.comparativeDMY = 'daily';

                    this.filterSHRAN = 'sold';
                    this.overAllDate = this.formatDate(new Date(), 'daily');

                    this.selectedAgent = 'myReports';
                    this.selectedAgentDWMY = 'daily';
                    this.agentDailyDate = this.formatDate(new Date(), 'daily');
                    this.agentWeeklyYear = this.formatDate(new Date(), 'year');
                    this.agentWeeklyNum = this.formatDate(new Date(), 'weekNum');
                    this.agentWeeklyDateRange = this.getDateRangeOfWeek(this.weeklyNum, this.weeklyYear);
                    this.agentMonthlyMonth = this.formatDate(new Date(), 'month');
                    this.agentMonthyYear = this.formatDate(new Date(), 'year');
                    this.agentYearlyYear = this.formatDate(new Date(), 'year');

                    if (!this.agentChart) {
                        var ctx = Polymer.dom(this.root).querySelector("#agentChart").getContext('2d');
                        var agentCharts = new Chart(ctx, {
                            type: 'horizontalBar',
                            options: {
                                responsive: true,
                                legend: {
                                    position: 'top'
                                },
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        },
                                        stacked: true
                                    }],
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        },
                                        stacked: true
                                    }]
                                },
                                plugins: {
                                    datalabels: {
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        },
                                    }
                                },
                            }
                        });
                        this.agentChart = agentCharts;
                    }
                }
            },

            _agentChartChanged(agentChart, selectedAgent, selectedAgentDWMY, agentDailyDate, agentWeeklyYear, agentWeeklyNum, agentMonthlyMonth, agentMonthyYear, agentYearlyYear) {
                if (agentChart) {
                    var mykey, query, agentQuery, self = this;
                    if (selectedAgentDWMY === 'daily') {
                        mykey = selectedAgentDWMY + "/" + agentDailyDate;
                    } else if (selectedAgentDWMY === 'weekly') {
                        mykey = selectedAgentDWMY + "/" + agentWeeklyYear.toString().substring(2, 4) + "w" + agentWeeklyNum.toString();
                    } else if (selectedAgentDWMY === 'monthly') {
                        mykey = selectedAgentDWMY + "/" + agentMonthyYear.toString() + "-" + agentMonthlyMonth;
                    } else if (selectedAgentDWMY === 'yearly') {
                        mykey = selectedAgentDWMY + "/" + agentYearlyYear.toString();
                    }

                    if (selectedAgent === 'myReports') {
                        query = "/reports/sales_agents/" + mykey + "/agents/" + this.mytype + "/" + this.mygroup + "/" + this.myaccountKey;
                    } else if (selectedAgent === 'agentType') {
                        query = "/reports/sales_agents/" + mykey + "/type";
                    } else if (selectedAgent === 'agentGroup') {
                        query = "/reports/sales_agents/" + mykey + "/groups/" + this.mytype;
                    } else if (selectedAgent === 'agents') {
                        query = "/reports/sales_agents/" + mykey + "/agents/" + this.mytype + "/" + this.mygroup;
                    }

                    var groupData = this.groupData;
                    var agentData = this.agentData;

                    firebase.database().ref(query).once('value', function (snapshot) {
                        var itemHold = [];
                        var itemSold = [];
                        var itemReserved = [];
                        var itemKey = [];

                        if (snapshot.exists()) {
                            if (selectedAgent === 'myReports') {
                                itemSold.push(snapshot.val().sold ? snapshot.val().sold : 0);
                                itemHold.push(snapshot.val().hold ? snapshot.val().hold : 0);
                                itemReserved.push(snapshot.val().reserved ? snapshot.val().reserved : 0);

                                var data = {
                                    labels: ['Sold', 'Hold', 'Reserved'],
                                    datasets: [
                                        {
                                            label: 'Sold',
                                            data: itemSold,
                                            backgroundColor: 'red',
                                        },
                                        {
                                            label: 'Hold',
                                            data: itemHold,
                                            backgroundColor: 'rgb(145, 145, 0)',
                                        },
                                        {
                                            label: 'Reserved',
                                            data: itemReserved,
                                            backgroundColor: 'orange',
                                        }
                                    ]
                                }

                                agentChart.data = data;
                                agentChart.update();
                            } else {
                                snapshot.forEach(function (element) {
                                    itemSold.push(element.val().sold ? element.val().sold : 0);
                                    itemHold.push(element.val().hold ? element.val().hold : 0);
                                    itemReserved.push(element.val().reserved ? element.val().reserved : 0);

                                    if (selectedAgent === 'agentType') {
                                        itemKey.push(_formatItemKey(element.key, 'agentType'));
                                    } else if (selectedAgent === 'agentGroup') {
                                        itemKey.push(_formatItemKey(element.key, 'agentGroup'));
                                    } else if (selectedAgent === 'agents') {
                                        itemKey.push(_formatItemKey(element.key, 'agents'));
                                    }
                                });

                                function _formatItemKey(itemKey, x) {
                                    if (x === "agentType") {
                                        if (itemKey === 'inhouse') { return "In House"; }
                                        else if (itemKey === 'broker') { return "Broker"; }
                                    } else if (x === 'agentGroup') {
                                        for (var i = 0; i < groupData.length; i++) {
                                            if (groupData[i].groupID === itemKey) { return groupData[i].name; }
                                        }
                                    } else if (x === 'agents') {
                                        for (var i = 0; i < agentData.length; i++) {
                                            if (agentData[i].$key === itemKey) { return agentData[i].lastname; }
                                        }
                                    }
                                }

                                var data = {
                                    labels: itemKey,
                                    datasets: [
                                        {
                                            label: 'Sold',
                                            data: itemSold,
                                            backgroundColor: 'red',
                                        },
                                        {
                                            label: 'Reserved',
                                            data: itemReserved,
                                            backgroundColor: 'orange',
                                        },
                                        {
                                            label: 'Hold',
                                            data: itemHold,
                                            backgroundColor: 'rgb(145, 145, 0)',
                                        }
                                    ]
                                }

                                agentChart.data = data;
                                agentChart.update();
                            }

                        } else {
                            var data = {
                                labels: ['No data found'],
                                datasets: []
                            }

                            agentChart.data = data;
                            agentChart.update();
                        }
                    });
                }
            },

            _selectedReportChanged() {
                if (this.selectedReport === 'activity') {
                    if (!this.activityChart) {
                        var ctx = Polymer.dom(this.root).querySelector('#activityChart').getContext('2d');
                        var activityCharts = new Chart(ctx, {
                            type: 'bar',
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                tooltips: {
                                    mode: 'index',
                                    intersect: false
                                },
                                legend: {
                                    position: 'bottom',
                                },
                                plugins: {
                                    datalabels: {
                                        color: 'white',
                                        font: {
                                            weight: 'bold'
                                        },
                                    }
                                },
                                scales: {
                                    yAxes: [{
                                        stacked: true,
                                        ticks: {
                                            beginAtZero: true
                                        },
                                        ticks: {
                                            fontSize: 11
                                        }
                                    }],
                                    xAxes: [{
                                        stacked: true,
                                        ticks: {
                                            beginAtZero: true
                                        }
                                    }]
                                }
                            }
                        });
                        this.activityChart = activityCharts;
                    }
                } else if (this.selectedReport === 'comparative') {
                    if (!this.comparativeChart) {
                        var ctx = Polymer.dom(this.root).querySelector("#comparativeChart").getContext('2d');
                        var comparativeCharts = new Chart(ctx, {
                            type: 'line',
                            options: {
                                legend: {
                                    position: 'bottom'
                                },
                                plugins: {
                                    datalabels: {
                                        display: false
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        }
                                    }]
                                }
                            }
                        });
                        this.comparativeChart = comparativeCharts;
                    }
                } else if (this.selectedReport === 'overall') {
                    if (!this.overAllChart) {
                        var ctx = Polymer.dom(this.root).querySelector("#overAllChart").getContext('2d');
                        var overAllCharts = new Chart(ctx, {
                            type: 'pie',
                            options: {
                                pieceLabel: {
                                    render: 'percentage',
                                    position: 'outside',
                                    fontColor: ['black', 'black', 'black', 'black', 'black'],
                                    precision: 2,
                                },
                                legend: {
                                    display: true,
                                    position: 'top',

                                },
                                plugins: {
                                    datalabels: {
                                        color: 'black',
                                        font: {
                                            weight: 'bold'
                                        },
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                        this.overAllChart = overAllCharts;
                    }
                }
            },

            _activityChanged(selectedDWMY, activityChart, dailyDate, weeklyYear, weeklyNum, monthlyMonth, monthyYear, yearlyYear) {
                if (activityChart) {
                    var salesQuery;

                    if (selectedDWMY === 'daily') {
                        salesQuery = '/reports/activity/daily/' + dailyDate;
                    } else if (selectedDWMY === 'weekly') {
                        var weekly = weeklyYear.toString().substring(2, 4) + 'w' + weeklyNum.toString();
                        salesQuery = '/reports/activity/weekly/' + weekly;
                    } else if (selectedDWMY === 'monthly') {
                        var monthly = monthyYear.toString() + '-' + monthlyMonth;
                        salesQuery = '/reports/activity/monthly/' + monthly;
                    } else if (selectedDWMY === 'yearly') {
                        salesQuery = '/reports/activity/yearly/' + yearlyYear.toString();
                    }

                    this.salesQuery = salesQuery + '/lotType';

                    firebase.database().ref(salesQuery + '/lotType').once('value', function (snapshot) {
                        if (snapshot.exists()) {
                            var itemHold = [];
                            var itemSold = [];
                            var itemReserved = [];
                            var itemKey = [];
                            var colors = [];

                            snapshot.forEach(function (element) {
                                var itemhold = element.val().hold ? element.val().hold : 0;
                                var itemsold = element.val().sold ? element.val().sold : 0;
                                var itemreserved = element.val().reserved ? element.val().reserved : 0;

                                if (element.key == 'lawnlots') { itemkey = 'Lawn Lots'; bgColor = '#2196F3'; }
                                else if (element.key == 'wallniche') { itemkey = 'Wall Niche'; bgColor = '#E91E63'; }
                                else if (element.key == 'bonechamber') { itemkey = 'Bone Chamber'; bgColor = '#3F51B5'; }
                                else if (element.key == 'cinerarium') { itemkey = 'Cinerarium'; bgColor = '#795548'; }
                                else if (element.key == 'familylots4') { itemkey = 'Family Lots 1 (37.45m²)'; bgColor = '#BA68C8'; }
                                else if (element.key == 'familylots5') { itemkey = 'Family Lots 1 (Irregular)'; bgColor = '#E1BEE7'; }
                                else if (element.key == 'familylots1') { itemkey = 'Family Lots 2 (53.27m²)'; bgColor = '#4A148C'; }
                                else if (element.key == 'familylots2') { itemkey = 'Family Lots 2 (52.83m²)'; bgColor = '#7B1FA2'; }
                                else if (element.key == 'familylots3') { itemkey = 'Family Lots 2 (Irregular)'; bgColor = '#9C27B0'; }
                                else if (element.key == 'gardenlots1') { itemkey = 'Garden Lots 1 (12.52m²)'; bgColor = '#DCEDC8'; }
                                else if (element.key == 'gardenlots2') { itemkey = 'Garden Lots 1 (12.43m²)'; bgColor = '#AED581'; }
                                else if (element.key == 'gardenlots3') { itemkey = 'Garden Lots 1 (Irregular)'; bgColor = '#8BC34A'; }
                                else if (element.key == 'gardenlots4') { itemkey = 'Garden Lots 2 (20.00m²)'; bgColor = '#689F38'; }
                                else if (element.key == 'gardenlots5') { itemkey = 'Garden Lots 2 (Irregular)'; bgColor = '#33691E'; }

                                itemHold.push(itemhold);
                                itemSold.push(itemsold);
                                itemReserved.push(itemreserved);

                                itemKey.push(itemkey);
                                colors.push(bgColor);
                            });

                            var soldColor = [];
                            var holdColor = [];
                            var reservedColor = [];
                            for (var i = 0; i < itemKey.length; i++) {
                                soldColor.push('rgb(245,0,0)');
                                holdColor.push('rgb(145, 145, 0)');
                                reservedColor.push('orange');
                            }

                            var data = {
                                labels: itemKey,
                                datasets: [
                                    {
                                        label: 'Sold',
                                        data: itemSold,
                                        backgroundColor: soldColor,
                                        borderColor: [
                                            'rgb(245,0,0)'
                                        ],
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Reserved',
                                        data: itemReserved,
                                        backgroundColor: reservedColor,
                                        borderColor: [
                                            'orange'
                                        ],
                                        borderWidth: 1
                                    },
                                    {
                                        label: 'Hold',
                                        data: itemHold,
                                        backgroundColor: holdColor,
                                        borderColor: [
                                            'rgb(145, 145, 0)'
                                        ],
                                        borderWidth: 1
                                    }
                                ]
                            };

                            activityChart.data = data;
                            activityChart.update();
                        } else {
                            var data = {
                                labels: ['Data not found'],
                                datasets: []
                            }

                            activityChart.data = data;
                            activityChart.update();
                        }
                    });
                }
            },

            _comparativeChanged(selectedComparativeLotTypes, comparativeDMY, comparativeChart, dailyFrom, dailyTo, monthlyMonthFrom, monthlyMonthTo, monthlyYearFrom, monthlyYearTo, yearlyYearFrom, yearlyYearTo) {
                var start, end, query;
                if (comparativeChart) {
                    if (comparativeDMY === 'daily') {
                        start = dailyFrom;
                        end = dailyTo;
                    } else if (comparativeDMY === 'monthly') {
                        start = monthlyYearFrom.toString() + "-" + monthlyMonthFrom;
                        end = monthlyYearTo.toString() + "-" + monthlyMonthTo;
                    }
                    else if (comparativeDMY === 'yearly') {
                        start = yearlyYearFrom.toString();
                        end = yearlyYearTo.toString();
                    }

                    var monthNames = [
                        "Jan", "Feb", "Mar",
                        "Apr", "May", "Jun", "Jul",
                        "Aug", "Sep", "Oct",
                        "Nov", "Dec"
                    ];

                    if (selectedComparativeLotTypes === 'all') {
                        query = "/reports/activity/" + comparativeDMY;
                    }
                    else {
                        query = "/reports/comparative/" + selectedComparativeLotTypes + "/" + comparativeDMY;
                    }

                    firebase.database().ref(query).orderByKey().startAt(start).endAt(end).once("value", function (snapshot) {
                        var typeHold = [];
                        var typeSold = [];
                        var typeReserved = [];
                        var labels = [];

                        if (snapshot.exists()) {
                            snapshot.forEach(element => {
                                if (comparativeDMY == 'daily') {
                                    labels.push(element.key.substring(8, 10));
                                }
                                if (comparativeDMY == 'monthly') {
                                    var index = new Date(element.key).getMonth();
                                    labels.push(monthNames[index]);
                                }
                                if (comparativeDMY == 'yearly') {
                                    labels.push(element.key.substring(0, 4));
                                }
                                typeSold.push(element.val().totalSold);
                                typeHold.push(element.val().totalHold);
                                typeReserved.push(element.val().totalReserved);

                                var data = {
                                    labels: labels,
                                    datasets: [{
                                        label: 'Sold',
                                        data: typeSold,
                                        backgroundColor: 'transparent',
                                        borderColor: 'red',
                                        borderWidth: 1,
                                        datalabels: {
                                            align: 'end',
                                            anchor: 'end',
                                            display: true,
                                            backgroundColor: 'red',
                                            borderRadius: 4,
                                            color: '#ddd',
                                            font: {
                                                weight: 'bold'
                                            }
                                        }
                                    },
                                    {
                                        label: 'Hold',
                                        data: typeHold,
                                        backgroundColor: 'transparent',
                                        borderColor: 'orange',
                                        borderWidth: 1,
                                        hidden: true,
                                        datalabels: {
                                            align: 'end',
                                            anchor: 'end',
                                            display: true,
                                            backgroundColor: 'orange',
                                            borderRadius: 4,
                                            color: '#001f3f',
                                            font: {
                                                weight: 'bold'
                                            }
                                        }
                                    },
                                    {
                                        label: 'Reserved',
                                        data: typeReserved,
                                        backgroundColor: 'transparent',
                                        borderColor: 'yellow',
                                        borderWidth: 1,
                                        hidden: true,
                                        datalabels: {
                                            align: 'end',
                                            anchor: 'end',
                                            display: true,
                                            backgroundColor: 'yellow',
                                            borderRadius: 4,
                                            color: '#001f3f',
                                            font: {
                                                weight: 'bold'
                                            }
                                        }
                                    }],

                                };

                                comparativeChart.data = data;
                                comparativeChart.update();
                            });
                        } else {
                            var data = {
                                labels: ['No data found'],
                                datasets: [],

                            };

                            comparativeChart.data = data;
                            comparativeChart.update();
                        }
                    });
                }
            },

            _overallChanged(overAllChart, overAllDate) {
                if (overAllChart) {
                    firebase.database().ref('/reports/overAll/' + overAllDate + '/overall').once('value', function (snap) {
                        var datas = [];
                        var labels = [];
                        var colors = [];

                        if (snap.exists()) {
                            snap.forEach(function (element) {
                                if (element.key == 'totalHold') { itemkey = 'Hold'; bgColor = 'rgb(145, 145, 0)'; }
                                else if (element.key == 'totalSold') { itemkey = 'Sold'; bgColor = 'red'; }
                                else if (element.key == 'totalReserved') { itemkey = 'Reserved'; bgColor = 'orange'; }
                                else if (element.key == 'totalAvailable') { itemkey = 'Available'; bgColor = 'green'; }
                                else if (element.key == 'totalNotyetavailable') { itemkey = 'Not yet available'; bgColor = 'gray'; }

                                datas.push(element.val());
                                labels.push(itemkey);
                                colors.push(bgColor);
                            });

                            var data = {
                                datasets: [{
                                    data: datas,
                                    backgroundColor: colors,
                                }],
                                labels: labels,
                            }

                            overAllChart.data = data;
                            overAllChart.update();
                        } else {
                            var data = {
                                labels: ['No data found'],
                                datasets: []
                            }

                            overAllChart.data = data;
                            overAllChart.update();
                        }
                    });
                }
            },

            formatDate(now, x) {
                if (x === 'daily') {
                    var day = ("0" + now.getDate()).slice(-2);
                    var month = ("0" + (now.getMonth() + 1)).slice(-2);
                    return now.getFullYear() + "-" + (month) + "-" + (day);
                } else if (x === 'weekNum') {
                    now = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
                    now.setUTCDate(now.getUTCDate() + 4 - (now.getUTCDay() || 7));
                    var yearStart = new Date(Date.UTC(now.getUTCFullYear(), 0, 1));
                    var weekNo = Math.ceil((((now - yearStart) / 86400000) + 1) / 7);
                    return weekNo;
                } else if (x === 'year') {
                    return now.getFullYear();
                } else if (x === 'month') {
                    return ("0" + (now.getMonth() + 1)).slice(-2);
                }
            },

            _formatLotTypes(e) {
                if (e == 'lawnlots') return 'Lawn Lots';
                else if (e == 'wallniche') return 'Wall Niche';
                else if (e == 'bonechamber') return 'Bone Chamber';
                else if (e == 'cinerarium') return 'Cinerarium';
                else if (e == 'familylots4') return 'Family Lots 1 (37.45m²)';
                else if (e == 'familylots5') return 'Family Lots 1 (Irregular)';
                else if (e == 'familylots1') return 'Family Lots 2 (53.27m²)';
                else if (e == 'familylots2') return 'Family Lots 2 (52.83m²)';
                else if (e == 'familylots3') return 'Family Lots 2 (Irregular)';
                else if (e == 'gardenlots1') return 'Garden Lots 1 (12.52m²)';
                else if (e == 'gardenlots2') return 'Garden Lots 1 (12.43m²)';
                else if (e == 'gardenlots3') return 'Garden Lots 1 (Irregular)';
                else if (e == 'gardenlots4') return 'Garden Lots 2 (20.00m²)';
                else if (e == 'gardenlots5') return 'Garden Lots 2 (Irregular)';
            },

            _formatLots(block, lot, level) {
                if (block && lot) {
                    if (level) return 'Block ' + block + ' Lot ' + lot + ' Level ' + level;
                    else return 'Block ' + block + ' Lot ' + lot;
                } else {
                    return '';
                }
            },

            _exportStaffTableToCSV() {
                this.export_table_to_csv('today', "today-reports.csv");
            },

            export_table_to_csv(report, filename) {
                var csv = [];
                if (report == 'daily') {
                    var rows = Polymer.dom(this.root).querySelectorAll("#salesTable tr");
                }
                else if (report == 'overAll') {
                    var rows = Polymer.dom(this.root).querySelectorAll("#overAllReportTable tr");
                }
                else if (report == 'today') {
                    var rows = Polymer.dom(this.root).querySelectorAll("#staffTable tr");
                }
                for (var i = 0; i < rows.length; i++) {
                    var row = [], cols = rows[i].querySelectorAll("td, th");

                    for (var j = 0; j < cols.length; j++)
                        row.push(cols[j].innerText);

                    csv.push(row.join(","));
                }
                this.download_csv(csv.join("\n"), filename);
            },

            download_csv(csv, filename) {
                var csvFile;
                var downloadLink;
                // CSV FILE
                csvFile = new Blob([csv], { type: "text/csv" });
                downloadLink = document.createElement("a");
                downloadLink.download = filename;
                downloadLink.href = window.URL.createObjectURL(csvFile);
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
                downloadLink.click();
            },

            _getLocalDatetimeFormat(e) {
                var xdate = new Date(e);
                return xdate.toDateString() + ' ' + xdate.toLocaleTimeString().replace(/:\d{2}\s/, ' ');;
            },

            getDateRangeOfWeek(weekNo, y) {
                Date.prototype.getWeek = function () {
                    var date = new Date(this.getTime());
                    date.setHours(0, 0, 0, 0);
                    // Thursday in current week decides the year.
                    date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
                    // January 4 is always in week 1.
                    var week1 = new Date(date.getFullYear(), 0, 4);
                    // Adjust to Thursday in week 1 and count number of weeks from date to week1.
                    return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
                }
                var rangeToFrom = [];
                var d1, numOfdaysPastSinceLastMonday, rangeIsFrom, rangeIsTo;
                d1 = new Date('' + y + '');
                numOfdaysPastSinceLastMonday = d1.getDay() - 1;
                d1.setDate(d1.getDate() - numOfdaysPastSinceLastMonday);
                d1.setDate(d1.getDate() + (7 * (weekNo - d1.getWeek())));
                rangeIsFrom = d1.getFullYear() + "-" + ("0" + (d1.getMonth() + 1)).slice(-2) + "-" + ("0" + d1.getDate()).slice(-2)
                d1.setDate(d1.getDate() + 6);
                rangeIsTo = d1.getFullYear() + "-" + ("0" + (d1.getMonth() + 1)).slice(-2) + "-" + ("0" + d1.getDate()).slice(-2)
                return rangeIsFrom + " - " + rangeIsTo;
            },

            _next() {
                this.entryanimation = "slide-from-right-animation";
                this.exitanimation = "slide-left-animation";
                this.selectedPage = (parseInt(this.selectedPage) + 1);
            },

            _back() {
                this.entryanimation = "slide-from-left-animation";
                this.exitanimation = "slide-right-animation";
                this.selectedPage = (parseInt(this.selectedPage) - 1);
            },

            ifHasValue(e) {
                if (e) return e;
                else return 0;
            },

            toggleDrawer() {
                this.dispatchEvent(new CustomEvent('toggleDrawer', {
                    bubbles: true, composed: true, detail: {
                        narrow: this.$.narrow
                    }
                }));
                this.$.narrow = !this.$.narrow;
            },
        })
    </script>
</dom-module>