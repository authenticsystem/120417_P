<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">

<script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />


<link rel="import" href="shared-styles.html">

<dom-module id="my-register-signin">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        /* overflow: hidden; */
      }

      @media (min-width: 767px) {
        .main-container {
          height: 100%;
          background-color: white;
          max-width: 370px;
          margin: 16px auto;
          padding: 40px;
          box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        }

      }

      @media (max-width: 767px) {
        :host {
          height: 100%;
        }
        .main-container {
          height: 100%;
          background-color: white;
          margin: 0 auto;
          padding: 40px;
          box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        }

      }

      paper-button.green {
        background-color: var(--paper-green-500);
        color: white;
        height: 38px;

      }

      .action {
        /* display: inline-block; */
        float: right;
      }

      .footer {
        height: 48px;
        /* align-items: middle; */
      }

      .header {
        font-size: 24px;
        font-weight: 400;
      }
    </style>

    <firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError"></firebase-auth>

    <div class="main-container">
      <a href="/">
        <iron-image placeholder="images/manifest/icon-512x512.png" data-src="images/manifest/icon-512x512.png" sizing="cover" preload
          fade style="width:128px; height:128px;"></iron-image>
      </a>
      </br>
      <div>
        <div class="header">Create account</div>
        </br>
        <div id="errorMessage" style="display: none;">
          <iron-icon icon="my-icons:error-outline"></iron-icon>&nbsp;{{validationMessage}}</div>
        <paper-input label="Name" id="name" value="{{displayName}}"></paper-input>
        <paper-input label="Email" id="email" value="{{email}}"></paper-input>
        <paper-input label="Password" type="password" id="password" value="{{password}}"></paper-input>
        </br>
        </br>
        <div class="footer">
          <div class="action">
            <a style="text-decoration:none;" href="/signin">
              <paper-button>cancel</paper-button>
            </a>
            <paper-button class="green" on-tap="_registerAccount">next</paper-button>
          </div>
        </div>
      </div>

    </div>


  </template>

  <script>
    Polymer({
      is: 'my-register-signin',

      handleError() {
        var errormsg = Polymer.dom(this.root).querySelector("#errorMessage");
        errormsg.setAttribute("style", "display: block; background-color:red; color:white; text-align:center; border-radius: 5px; opacity:0.5; padding:5px");
        this.validationMessage = 'Invalid username/password';
      },

      _registerAccount() {
        // here 1am
        if (!this.email || !this.password) {
          var errormsg = Polymer.dom(this.root).querySelector("#errorMessage");
          errormsg.setAttribute("style", "display: block; background-color:red; color:white; text-align:center; border-radius: 5px; opacity:0.5; padding:5px");
          this.validationMessage = 'Invalid empty email/password.';
        }
        else {
          this.$.auth.createUserWithEmailAndPassword(this.email, this.password)
            .then(function (user) {
              app = this.document.querySelector('my-app');
              app.set('route.path', '/');
              user.sendEmailVerification().then(function () {
              });
            })
        }
      }
    })

  </script>
  <script type="text/javascript">
    // FirebaseUI config.
    var uiConfig = {
      signInSuccessUrl: 'my-app.html',
      signInOptions: [
        // Leave the lines as is for the providers you want to offer your users.
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        firebase.auth.FacebookAuthProvider.PROVIDER_ID,
        firebase.auth.TwitterAuthProvider.PROVIDER_ID,
        firebase.auth.GithubAuthProvider.PROVIDER_ID,
        firebase.auth.EmailAuthProvider.PROVIDER_ID,
        firebase.auth.PhoneAuthProvider.PROVIDER_ID
      ],
      // Terms of service url.
      tosUrl: '<your-tos-url>'
    };

    // Initialize the FirebaseUI Widget using Firebase.
    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    // The start method will wait until the DOM is loaded.
    ui.start('#firebaseui-auth-container', uiConfig);
  </script>
</dom-module>